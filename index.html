<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kimmy's Jolli - Food Ordering System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    .section { opacity:0; transform:translateY(20px); transition:all 0.6s ease; }
    .section.active { opacity:1; transform:translateY(0); }
    html { scroll-behavior:smooth; }
    .hidden { display: none !important; }
    .map-container {
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
    }
  </style>
</head>
<body class="bg-red-50 font-sans">

  <!-- Navbar -->
  <nav class="flex justify-between items-center bg-red-600 text-white px-6 py-4 flex-wrap shadow-lg">
    <div class="flex items-center space-x-4">
      <img src="logo.png" alt="Kimmy's Jolli Logo" class="w-10 h-10 object-contain rounded-full">
      <h1 class="text-2xl font-bold">Kimmy's Jolli</h1>
      <span id="userRoleBadge" class="bg-yellow-500 text-red-800 px-3 py-1 rounded-full text-sm font-bold"></span>
    </div>
    <div class="space-x-2 mt-2 sm:mt-0 flex flex-wrap gap-2" id="navButtons">
      <!-- Home Button -->
      <button id="homeBtn" class="nav-btn hover:bg-red-700 px-4 py-2 rounded transition-colors">
        <i class="fas fa-home mr-2"></i>Home
      </button>

      <!-- Customer Buttons -->
      <button id="browseBtn" class="nav-btn hover:bg-red-700 px-4 py-2 rounded transition-colors">
        <i class="fas fa-utensils mr-2"></i>Browse Menu
      </button>
      <button id="placeOrderBtn" class="nav-btn hover:bg-red-700 px-4 py-2 rounded transition-colors">
        <i class="fas fa-shopping-cart mr-2"></i>Place Order
      </button>
      <button id="paymentBtn" class="nav-btn hover:bg-red-700 px-4 py-2 rounded transition-colors">
        <i class="fas fa-credit-card mr-2"></i>Make Payment
      </button>
      <button id="trackBtn" class="nav-btn hover:bg-red-700 px-4 py-2 rounded transition-colors">
        <i class="fas fa-map-marker-alt mr-2"></i>Track Order
      </button>

      <!-- Staff Buttons -->
      <button id="updateBtn" class="nav-btn hover:bg-red-700 px-4 py-2 rounded transition-colors">
        <i class="fas fa-sync-alt mr-2"></i>Update Order Status
      </button>

      <!-- Admin Buttons -->
      <button id="manageMenuBtn" class="nav-btn hover:bg-red-700 px-4 py-2 rounded transition-colors">
        <i class="fas fa-list-alt mr-2"></i>Manage Menu Items
      </button>
      <button id="manageUsersBtn" class="nav-btn hover:bg-red-700 px-4 py-2 rounded transition-colors">
        <i class="fas fa-users-cog mr-2"></i>Manage Users
      </button>

      <!-- Logout Button -->
      <button id="logoutBtn" class="bg-yellow-500 text-red-800 px-4 py-2 rounded hover:bg-yellow-600 transition-colors font-bold">
        <i class="fas fa-sign-out-alt mr-2"></i>Logout
      </button>
    </div>
  </nav>

  <!-- Hero Banner -->
  <section id="heroSection" class="relative w-full h-64 md:h-96 bg-cover bg-center text-white flex items-center justify-center" style="background-image:url('kk.webp');">
    <div class="bg-black bg-opacity-50 w-full h-full absolute top-0 left-0"></div>
    <div class="relative z-10 text-center px-4">
      <h1 class="text-4xl md:text-6xl font-bold">Welcome to Kimmy's Jolli</h1>
      <p class="mt-4 text-lg md:text-2xl" id="welcomeMessage">Bringing the joy of delicious food straight to your fingertips </p>
      <button id="orderNowBtn" class="mt-6 bg-yellow-400 text-red-700 font-bold px-6 py-3 rounded-lg hover:bg-yellow-500 transition-all duration-300 w-full sm:w-auto">
        <i class="fas fa-bolt mr-2"></i>Order Now
      </button>
    </div>
  </section>

  <!-- Homepage Section -->
  <section id="homepageSection" class="section active p-8">
    <!-- About Section -->
    <div class="max-w-6xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-4xl font-bold text-red-700 mb-4">About Kimmy's Jolli</h2>
        <p class="text-lg text-gray-600 max-w-3xl mx-auto">
          Welcome to Kimmy's Jolli, your favorite local food destination in Mabini, Batangas! 
          We're passionate about serving delicious, high-quality meals that bring joy to every bite.
        </p>
      </div>

      <!-- Stats Section -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
        <div class="bg-white rounded-xl p-6 text-center shadow-lg">
          <div class="text-3xl font-bold text-red-600 mb-2">500+</div>
          <div class="text-gray-600">Happy Customers Served</div>
        </div>
        <div class="bg-white rounded-xl p-6 text-center shadow-lg">
          <div class="text-3xl font-bold text-red-600 mb-2">50+</div>
          <div class="text-gray-600">Delicious Menu Items</div>
        </div>
        <div class="bg-white rounded-xl p-6 text-center shadow-lg">
          <div class="text-3xl font-bold text-red-600 mb-2">24/7</div>
          <div class="text-gray-600">Online Ordering Available</div>
        </div>
      </div>

      <!-- Mission & Vision -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
        <div class="bg-red-600 text-white rounded-xl p-8 shadow-lg">
          <div class="text-center mb-4">
            <i class="fas fa-bullseye text-4xl mb-4"></i>
            <h3 class="text-2xl font-bold mb-4">Our Mission</h3>
          </div>
          <p class="text-lg leading-relaxed">
            To provide exceptional dining experiences by serving high-quality, delicious food 
            with outstanding customer service. We strive to be the heart of our community, 
            bringing people together through the joy of great food.
          </p>
        </div>
        
        <div class="bg-yellow-500 text-red-800 rounded-xl p-8 shadow-lg">
          <div class="text-center mb-4">
            <i class="fas fa-eye text-4xl mb-4"></i>
            <h3 class="text-2xl font-bold mb-4">Our Vision</h3>
          </div>
          <p class="text-lg leading-relaxed">
            To become the most beloved food establishment in Batangas, known for our 
            commitment to quality, innovation in Filipino cuisine, and creating memorable 
            experiences for every customer who walks through our doors.
          </p>
        </div>
      </div>

      <!-- Why Choose Us -->
      <div class="bg-white rounded-xl p-8 shadow-lg mb-12">
        <h3 class="text-3xl font-bold text-center text-red-700 mb-8">Why Choose Kimmy's Jolli?</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="text-center">
            <i class="fas fa-star text-yellow-500 text-3xl mb-4"></i>
            <h4 class="font-bold text-lg mb-2">Premium Quality</h4>
            <p class="text-gray-600">Only the freshest ingredients in every dish</p>
          </div>
          <div class="text-center">
            <i class="fas fa-clock text-red-600 text-3xl mb-4"></i>
            <h4 class="font-bold text-lg mb-2">Fast Service</h4>
            <p class="text-gray-600">Quick preparation and delivery</p>
          </div>
          <div class="text-center">
            <i class="fas fa-heart text-pink-500 text-3xl mb-4"></i>
            <h4 class="font-bold text-lg mb-2">Family-Friendly</h4>
            <p class="text-gray-600">Perfect for family gatherings</p>
          </div>
          <div class="text-center">
            <i class="fas fa-truck text-green-500 text-3xl mb-4"></i>
            <h4 class="font-bold text-lg mb-2">Free Delivery</h4>
            <p class="text-gray-600">Within Mabini area</p>
          </div>
        </div>
      </div>

      <!-- Location Section -->
      <div class="bg-white rounded-xl p-8 shadow-lg">
        <h3 class="text-3xl font-bold text-center text-red-700 mb-8">Visit Us Today!</h3>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div>
            <h4 class="text-xl font-bold text-gray-800 mb-4">Location Details</h4>
            <div class="space-y-3 text-gray-600">
              <p class="flex items-center">
                <i class="fas fa-map-marker-alt text-red-600 mr-3"></i>
                236 National Rd, Mabini, Batangas
              </p>
              <p class="flex items-center">
                <i class="fas fa-clock text-red-600 mr-3"></i>
                Open Daily: 8:00 AM - 10:00 PM
              </p>
              <p class="flex items-center">
                <i class="fas fa-phone text-red-600 mr-3"></i>
                09701484495
              </p>
              <p class="flex items-center">
                <i class="fas fa-envelope text-red-600 mr-3"></i>
                kimmysjolli@email.com
              </p>
            </div>
            <div class="mt-6 p-4 bg-yellow-50 rounded-lg">
              <h5 class="font-bold text-yellow-800 mb-2">Special Offer!</h5>
              <p class="text-yellow-700">Mention this website and get 10% off your first order when you visit our physical store!</p>
            </div>
          </div>
          <div class="map-container">
            <iframe 
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3874.735381926233!2d120.93941527599826!3d13.794793495719032!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x33bd112b5f2b3a67%3A0x9c8b9e9c8b9e9c8b!2s236%20National%20Rd%2C%20Mabini%2C%20Batangas!5e0!3m2!1sen!2sph!4v1690000000000!5m2!1sen!2sph" 
              width="100%" 
              height="100%" 
              style="border:0;" 
              allowfullscreen="" 
              loading="lazy" 
              referrerpolicy="no-referrer-when-downgrade">
            </iframe>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Home Section (Bestsellers) -->
  <section id="homeSection" class="section hidden p-8">
    <h2 class="text-3xl font-bold text-center text-red-700 mb-8">üçî Our Bestsellers</h2>
    <div id="homeItems" class="grid gap-8 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
  </section>

  <!-- Browse Section -->
  <section id="browseSection" class="section hidden p-8 bg-white rounded-xl mx-6 mt-8 shadow-inner">
    <h2 class="text-3xl font-bold text-red-700 mb-4">üìñ Browse Menu</h2>
    <div id="browseItems" class="grid gap-8 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"></div>
  </section>

  <!-- Place Order Section -->
  <section id="placeOrderSection" class="section hidden p-8 bg-white rounded-xl mx-6 mt-8 shadow-inner">
    <h2 class="text-3xl font-bold text-red-700 mb-4">üìù Your Cart</h2>
    <div id="cartItemsPlaceOrder" class="space-y-4"></div>
    <div class="mt-4 flex justify-end">
      <button id="confirmCartBtn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
        <i class="fas fa-check mr-2"></i>Confirm Order
      </button>
    </div>
  </section>

  <!-- Payment Section -->
  <section id="makePaymentSection" class="section hidden p-8 bg-white rounded-xl mx-6 mt-8 shadow-inner">
    <h2 class="text-3xl font-bold text-red-700 mb-4">üí≥ Make Payment</h2>
    <div id="cartItemsPayment" class="space-y-4"></div>
    <h3 id="paymentTotal" class="text-xl font-bold text-red-600 text-right mt-2"></h3>
  </section>

  <!-- Track Order Section -->
  <section id="trackOrderSection" class="section hidden p-8 bg-white rounded-xl mx-6 mt-8 shadow-inner">
    <h2 class="text-3xl font-bold text-red-700 mb-4">üìç Track Order</h2>
    <div id="trackList" class="space-y-4"></div>
  </section>

  <!-- Update Order Section -->
  <section id="updateOrderSection" class="section hidden p-8 bg-white rounded-xl mx-6 mt-8 shadow-inner">
    <h2 class="text-3xl font-bold text-red-700 mb-4">‚öôÔ∏è Update Order Status</h2>
    <div id="updateList" class="space-y-4"></div>
  </section>

  <!-- Manage Menu Section -->
  <section id="manageMenuSection" class="section hidden p-8 bg-white rounded-xl mx-6 mt-8 shadow-inner">
    <h2 class="text-3xl font-bold text-red-700 mb-4">üìã Manage Menu Items</h2>
    <div id="menuList" class="space-y-4"></div>
    <button onclick="addMenuItem()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
      <i class="fas fa-plus mr-2"></i>Add New Item
    </button>
  </section>

  <!-- Manage Users Section -->
  <section id="manageUsersSection" class="section hidden p-8 bg-white rounded-xl mx-6 mt-8 shadow-inner">
    <h2 class="text-3xl font-bold text-red-700 mb-4">üë• Manage Users</h2>
    <div id="userList" class="space-y-4"></div>
    <button onclick="addUser()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
      <i class="fas fa-user-plus mr-2"></i>Add New User
    </button>
  </section>

  <!-- Payment Modal -->
  <div id="paymentModal" class="fixed inset-0 hidden items-center justify-center bg-black bg-opacity-50 z-50">
    <div class="bg-white p-6 rounded-xl shadow-lg w-96 text-center">
      <h2 class="text-2xl font-bold text-red-600 mb-4">üí≥ Choose Payment Method</h2>
      <div class="space-y-3 text-left">
        <label class="flex items-center gap-3"><input type="radio" name="paymentMethod" value="Cash on Delivery" required /> <span>üíµ Cash on Delivery</span></label>
        <label class="flex items-center gap-3"><input type="radio" name="paymentMethod" value="GCash" /> <span>üì± GCash</span></label>
        <label class="flex items-center gap-3"><input type="radio" name="paymentMethod" value="Credit Card" /> <span>üí≥ Credit / Debit Card</span></label>
      </div>
      <div class="mt-6 flex justify-between">
        <button onclick="closePaymentModal()" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Cancel</button>
        <button onclick="confirmPayment()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-red-800 text-white py-8 mt-12">
    <div class="max-w-6xl mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
          <h3 class="text-xl font-bold mb-4">Kimmy's Jolli</h3>
          <p class="text-red-200">Serving delicious meals with love and passion since 2024.</p>
        </div>
        <div>
          <h3 class="text-xl font-bold mb-4">Quick Links</h3>
          <ul class="space-y-2">
            <li><a href="#" class="text-red-200 hover:text-white transition-colors">Home</a></li>
            <li><a href="#" class="text-red-200 hover:text-white transition-colors">Menu</a></li>
            <li><a href="#" class="text-red-200 hover:text-white transition-colors">About Us</a></li>
            <li><a href="#" class="text-red-200 hover:text-white transition-colors">Contact</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-xl font-bold mb-4">Contact Info</h3>
          <div class="space-y-2 text-red-200">
            <p>üì±09701484495</p>
            <p>‚úâÔ∏è kimmysjolli@email.com</p>
            <p>üìç 236 National Rd, Mabini, Batangas</p>
          </div>
        </div>
      </div>
      <div class="border-t border-red-700 mt-8 pt-6 text-center text-red-300">
        <p>&copy; 2024 Kimmy's Jolli. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <script>
    // ===== Authentication Check =====
    function checkAuthentication() {
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (!currentUser) {
        // Redirect based on user type
        if (window.location.pathname.includes('staff-login.html')) {
          window.location.href = 'staff-login.html';
        } else {
          window.location.href = 'customer-login.html';
        }
        return null;
      }
      return currentUser;
    }

    // ===== Role-Based Access Control =====
    function setupRoleBasedAccess(role) {
      const navButtons = document.querySelectorAll('.nav-btn');
      const roleBadge = document.getElementById('userRoleBadge');
      const welcomeMessage = document.getElementById('welcomeMessage');

      // Hide all buttons first
      navButtons.forEach(btn => btn.classList.add('hidden'));

      // Show buttons based on role
      switch(role) {
        case 'customer':
          document.getElementById('homeBtn').classList.remove('hidden');
          document.getElementById('browseBtn').classList.remove('hidden');
          document.getElementById('placeOrderBtn').classList.remove('hidden');
          document.getElementById('paymentBtn').classList.remove('hidden');
          document.getElementById('trackBtn').classList.remove('hidden');
          roleBadge.textContent = 'Customer';
          welcomeMessage.textContent = 'Enjoy our delicious food favorites! ';
          break;
        case 'staff':
          document.getElementById('homeBtn').classList.remove('hidden');
          document.getElementById('updateBtn').classList.remove('hidden');
          roleBadge.textContent = 'Staff';
          welcomeMessage.textContent = 'Manage order status and keep things moving! ‚ö°';
          break;
        case 'admin':
          document.getElementById('homeBtn').classList.remove('hidden');
          document.getElementById('updateBtn').classList.remove('hidden');
          document.getElementById('manageMenuBtn').classList.remove('hidden');
          document.getElementById('manageUsersBtn').classList.remove('hidden');
          roleBadge.textContent = 'Administrator';
          welcomeMessage.textContent = 'Manage the complete food ordering system! üîß';
          break;
      }
    }

    // ===== Data Management with localStorage =====
    let cart = JSON.parse(localStorage.getItem('jollibeeCart')) || [];
    let foodItems = JSON.parse(localStorage.getItem('jollibeeMenu')) || [
      { name: "1-pc Chickenjoy w/ Rice", price: 99, img: "chicken.png" },
      { name: "2-pc Burger Steak", price: 129, img: "burger.jpg" },
      { name: "Jolly Spaghetti", price: 80, img: "spag.jpg" },
      { name: "Yumburger", price: 50, img: "yumburger.jpg" },
      { name: "Jolly Hotdog", price: 50, img: "hotdogg.webp" },
      { name: "Jolly Fries", price: 150, img: "fries.webp" },
      { name: "Pineapple Juice", price: 55, img: "juice.jpg" },
      { name: "Peach Mango Pie", price: 45, img: "mango.jpg" }
    ];

    let orders = JSON.parse(localStorage.getItem('jollibeeOrders')) || [
      { id: 1, customer: "Cathy", status: "Preparing", items: ["1-pc Chickenjoy w/ Rice"], total: 99 },
      { id: 2, customer: "John", status: "Delivered", items: ["Yumburger", "Jolly Fries"], total: 200 }
    ];

    // Initialize customer users if not exists
    if (!localStorage.getItem('customerUsers')) {
      const defaultCustomers = [
        {
          id: 1,
          name: 'Demo Customer',
          email: 'customer@kimmysjolli.com',
          phone: '+1234567890',
          password: 'pass123',
          role: 'customer',
          createdAt: new Date().toISOString()
        }
      ];
      localStorage.setItem('customerUsers', JSON.stringify(defaultCustomers));
    }

    // Initialize staff users if not exists
    if (!localStorage.getItem('staffUsers')) {
      const defaultStaff = [
        {
          id: 1,
          username: 'staff1',
          password: 'pass123',
          role: 'staff',
          name: 'Staff Member',
          createdAt: new Date().toISOString()
        },
        {
          id: 2,
          username: 'admin',
          password: 'admin123',
          role: 'admin',
          name: 'System Administrator',
          createdAt: new Date().toISOString()
        }
      ];
      localStorage.setItem('staffUsers', JSON.stringify(defaultStaff));
    }

    // ===== Save Data Functions =====
    function saveCart() { localStorage.setItem('jollibeeCart', JSON.stringify(cart)); }
    function saveMenu() { localStorage.setItem('jollibeeMenu', JSON.stringify(foodItems)); }
    function saveOrders() { localStorage.setItem('jollibeeOrders', JSON.stringify(orders)); }
    function saveCustomerUsers() { localStorage.setItem('customerUsers', JSON.stringify(JSON.parse(localStorage.getItem('customerUsers') || '[]'))); }
    function saveStaffUsers() { localStorage.setItem('staffUsers', JSON.stringify(JSON.parse(localStorage.getItem('staffUsers') || '[]'))); }

    // ===== Initialize App =====
    function initApp() {
      const currentUser = checkAuthentication();
      if (currentUser) {
        setupRoleBasedAccess(currentUser.role);
        renderFood('homeItems');
        renderFood('browseItems');
        displayOrders();
        displayUpdateOrders();
        displayMenuItems();
        displayUsers();
      }
    }

    // ===== Render Food =====
    function renderFood(sectionId){
      const container = document.getElementById(sectionId);
      container.innerHTML = '';
      foodItems.forEach(item => {
        container.innerHTML += `
          <div class="bg-white rounded-2xl shadow-lg p-5 text-center hover:shadow-2xl transition transform hover:-translate-y-1">
            <img src="${item.img}" class="w-40 h-40 object-cover mx-auto rounded-lg" alt="${item.name}" />
            <h2 class="text-lg font-bold mt-3 text-gray-800">${item.name}</h2>
            <p class="text-gray-600 font-semibold">‚Ç±${item.price}</p>
            <button onclick="confirmAddToCart('${item.name}',${item.price})" class="mt-3 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors">
              <i class="fas fa-cart-plus mr-2"></i>Add to Cart
            </button>
          </div>`;
      });
    }

    // ===== Cart Functions =====
    function confirmAddToCart(name, price){
      if(confirm(`Add "${name}" to cart for ‚Ç±${price}?`)){
        addToCart(name, price);
      }
    }

    function addToCart(name, price){
      const existing = cart.find(i => i.name === name);
      if(existing) existing.quantity++; 
      else cart.push({name, price, quantity: 1});
      saveCart();
      displayCartInPlaceOrder();
      displayCartInPayment();
    }

    function increaseQuantity(name){ 
      const item = cart.find(i=>i.name===name); 
      if(item){ 
        item.quantity++; 
        saveCart();
        displayCartInPlaceOrder(); 
        displayCartInPayment(); 
      } 
    }

    function decreaseQuantity(name){ 
      const item = cart.find(i=>i.name===name); 
      if(item){ 
        if(item.quantity>1) item.quantity--; 
        else cart = cart.filter(i=>i.name!==name); 
        saveCart();
        displayCartInPlaceOrder(); 
        displayCartInPayment(); 
      } 
    }

    function displayCartInPlaceOrder(){
      const container = document.getElementById('cartItemsPlaceOrder'); 
      container.innerHTML='';
      if(cart.length===0){ 
        container.innerHTML=`<p class="text-gray-600 text-center py-8">Your cart is empty üçî</p>`; 
        return; 
      }
      cart.forEach(item=>{
        const total=item.price*item.quantity;
        container.innerHTML+=`<div class="flex justify-between items-center bg-white p-4 rounded-lg shadow mb-2 flex-wrap gap-2 border">
          <div class="flex-1 min-w-200">
            <h4 class="font-bold text-gray-800">${item.name}</h4>
            <p class="text-gray-600">‚Ç±${item.price} each</p>
          </div>
          <div class="flex items-center gap-2">
            <button onclick="decreaseQuantity('${item.name}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-700">‚àí</button>
            <span class="font-bold w-8 text-center">${item.quantity}</span>
            <button onclick="increaseQuantity('${item.name}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-700">+</button>
          </div>
          <p class="font-bold text-red-600 w-20 text-right">‚Ç±${total}</p>
        </div>`;
      });
    }

    function displayCartInPayment(){
      const container = document.getElementById('cartItemsPayment'); 
      container.innerHTML=''; 
      let total=0;
      if(cart.length===0){ 
        container.innerHTML=`<p class="text-gray-600 text-center py-8">Your cart is empty üçî</p>`; 
        return; 
      }
      cart.forEach(item=>{ 
        const itemTotal=item.price*item.quantity; 
        total+=itemTotal;
        container.innerHTML+=`<div class="flex justify-between items-center bg-white p-4 rounded-lg shadow mb-2 border">
          <div>
            <h4 class="font-bold text-gray-800">${item.name}</h4>
            <p class="text-gray-600">‚Ç±${item.price} each √ó ${item.quantity}</p>
          </div>
          <p class="font-bold text-red-600">‚Ç±${itemTotal}</p>
        </div>`;
      });
      document.getElementById('paymentTotal').innerHTML=`<div class="text-2xl font-bold border-t pt-2">Total: ‚Ç±${total}</div>`;
    }

    // ===== Payment Functions =====
    function openPaymentModal(){
      if(cart.length===0){ alert("Your cart is empty!"); return; }
      displayCartInPayment();
      document.getElementById('paymentModal').classList.remove('hidden'); 
    }

    function closePaymentModal(){ 
      document.getElementById('paymentModal').classList.add('hidden'); 
    }

    function confirmPayment(){
      const selected=document.querySelector('input[name="paymentMethod"]:checked'); 
      if(!selected){ alert("Please select a payment method!"); return; } 
      
      // Create new order
      const orderTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const newOrder = {
        id: orders.length + 1,
        customer: currentUser.name || currentUser.username,
        customerEmail: currentUser.email || currentUser.username,
        status: "Preparing",
        items: cart.map(item => `${item.name} (x${item.quantity})`),
        total: orderTotal,
        paymentMethod: selected.value,
        timestamp: new Date().toISOString()
      };
      
      orders.push(newOrder);
      saveOrders();
      
      alert(`‚úÖ Order placed!\nOrder #${newOrder.id}\nPayment: ${selected.value}\nTotal: ‚Ç±${orderTotal}`);
      cart = [];
      saveCart();
      displayCartInPlaceOrder(); 
      displayCartInPayment(); 
      closePaymentModal();
      displayOrders();
      displayUpdateOrders();
    }

    // ===== Order Management =====
    function displayOrders(){ 
      const container=document.getElementById("trackList"); 
      container.innerHTML='';
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      
      const userOrders = orders.filter(order => 
        currentUser.role === 'customer' ? 
        (order.customer === currentUser.name || order.customerEmail === currentUser.email) : 
        true
      );

      if(userOrders.length===0){ 
        container.innerHTML=`<p class="text-gray-600 text-center py-8">No orders found.</p>`; 
        return; 
      }
      userOrders.forEach(order=>{ 
        container.innerHTML+=`<div class="flex justify-between items-center bg-white p-4 rounded-lg shadow border flex-wrap gap-2">
          <div class="flex-1">
            <h4 class="font-bold text-gray-800">Order #${order.id} - ${order.customer}</h4>
            <p class="text-gray-600 text-sm">${order.items.join(', ')}</p>
            <p class="text-gray-500 text-xs">${new Date(order.timestamp).toLocaleString()}</p>
          </div>
          <div class="text-right">
            <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold ${
              order.status === 'Delivered' ? 'bg-green-200 text-green-800' :
              order.status === 'Out for Delivery' ? 'bg-yellow-200 text-yellow-800' :
              'bg-blue-200 text-blue-800'
            }">${order.status}</span>
            <p class="font-bold text-red-600 mt-1">‚Ç±${order.total}</p>
          </div>
        </div>`; 
      }); 
    }

    function displayUpdateOrders(){ 
      const container=document.getElementById("updateList"); 
      container.innerHTML='';
      if(orders.length===0){ 
        container.innerHTML=`<p class="text-gray-600 text-center py-8">No orders to update.</p>`; 
        return; 
      }
      orders.forEach(order=>{ 
        container.innerHTML+=`<div class="flex justify-between items-center bg-white p-4 rounded-lg shadow border flex-wrap gap-2">
          <div class="flex-1">
            <h4 class="font-bold text-gray-800">Order #${order.id} - ${order.customer}</h4>
            <p class="text-gray-600 text-sm">${order.items.join(', ')}</p>
            <p class="text-gray-500 text-xs">${new Date(order.timestamp).toLocaleDateString()}</p>
          </div>
          <div class="flex gap-2 flex-wrap">
            <select id="status-${order.id}" class="border rounded px-2 py-1">
              <option value="Preparing" ${order.status==='Preparing'?'selected':''}>Preparing</option>
              <option value="Out for Delivery" ${order.status==='Out for Delivery'?'selected':''}>Out for Delivery</option>
              <option value="Delivered" ${order.status==='Delivered'?'selected':''}>Delivered</option>
            </select>
            <button onclick="updateStatus(${order.id})" class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700">
              <i class="fas fa-save mr-1"></i>Update
            </button>
          </div>
        </div>`; 
      }); 
    }

    function updateStatus(orderId){ 
      const select=document.getElementById(`status-${orderId}`); 
      const order=orders.find(o=>o.id===orderId); 
      if(order){ 
        order.status=select.value; 
        saveOrders();
        alert(`‚úÖ Order #${orderId} updated to ${order.status}`); 
        displayOrders(); 
        displayUpdateOrders(); 
      } 
    }

    // ===== Menu Management =====
    function displayMenuItems(){ 
      const container=document.getElementById("menuList"); 
      container.innerHTML='';
      foodItems.forEach((item,index)=>{ 
        container.innerHTML+=`<div class="flex justify-between items-center bg-white p-4 rounded-lg shadow border flex-wrap gap-2">
          <div class="flex items-center gap-4 flex-1">
            <img src="${item.img}" class="w-16 h-16 object-cover rounded" alt="${item.name}" />
            <div>
              <h4 class="font-bold text-gray-800">${item.name}</h4>
              <p class="text-gray-600">‚Ç±${item.price}</p>
            </div>
          </div>
          <div class="flex gap-2 flex-wrap">
            <button onclick="editMenuItem(${index})" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
              <i class="fas fa-edit mr-1"></i>Edit
            </button>
            <button onclick="deleteMenuItem(${index})" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
              <i class="fas fa-trash mr-1"></i>Delete
            </button>
          </div>
        </div>`; 
      }); 
    }

    function addMenuItem(){ 
      const name=prompt("Enter item name:"); 
      const price=parseFloat(prompt("Enter price:")); 
      const img=prompt("Enter image URL:"); 
      if(name && !isNaN(price) && img){ 
        foodItems.push({name,price,img}); 
        saveMenu();
        displayMenuItems(); 
        renderFood('homeItems'); 
        renderFood('browseItems'); 
      } 
    }

    function editMenuItem(index){ 
      const item=foodItems[index]; 
      const name=prompt("Edit name:",item.name); 
      const price=parseFloat(prompt("Edit price:",item.price)); 
      const img=prompt("Edit image URL:",item.img); 
      if(name && !isNaN(price) && img){ 
        foodItems[index]={name,price,img}; 
        saveMenu();
        displayMenuItems(); 
        renderFood('homeItems'); 
        renderFood('browseItems'); 
      } 
    }

    function deleteMenuItem(index){ 
      if(confirm(`Delete "${foodItems[index].name}" from menu?`)){ 
        foodItems.splice(index,1); 
        saveMenu();
        displayMenuItems(); 
        renderFood('homeItems'); 
        renderFood('browseItems'); 
      } 
    }

    // ===== Enhanced User Management =====
    function displayUsers(){ 
      const container=document.getElementById("userList"); 
      container.innerHTML='';
      
      // Get both customer and staff users
      const customerUsers = JSON.parse(localStorage.getItem('customerUsers') || '[]');
      const staffUsers = JSON.parse(localStorage.getItem('staffUsers') || '[]');
      const allUsers = [...customerUsers, ...staffUsers];
      
      if(allUsers.length===0){ 
        container.innerHTML=`<p class="text-gray-600 text-center py-8">No users found.</p>`; 
        return; 
      }
      
      allUsers.forEach((user,index)=>{ 
        const userType = user.role === 'customer' ? 'customerUsers' : 'staffUsers';
        const userIndex = userType === 'customerUsers' ? 
          customerUsers.findIndex(u => u.id === user.id) : 
          staffUsers.findIndex(u => u.id === user.id);
        
        container.innerHTML+=`<div class="flex justify-between items-center bg-white p-4 rounded-lg shadow border flex-wrap gap-2">
          <div class="flex-1">
            <h4 class="font-bold text-gray-800">${user.name || user.username}</h4>
            <div class="flex gap-4 text-sm text-gray-600">
              <span class="capitalize">Role: ${user.role}</span>
              <span>Type: ${userType === 'customerUsers' ? 'Customer' : 'Staff'}</span>
              <span>Email: ${user.email || 'N/A'}</span>
            </div>
            <p class="text-xs text-gray-500 mt-1">Created: ${new Date(user.createdAt).toLocaleDateString()}</p>
          </div>
          <div class="flex gap-2 flex-wrap">
            <button onclick="editUser('${userType}', ${userIndex})" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
              <i class="fas fa-edit mr-1"></i>Edit
            </button>
            <button onclick="deleteUser('${userType}', ${userIndex})" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
              <i class="fas fa-trash mr-1"></i>Delete
            </button>
          </div>
        </div>`; 
      }); 
    }

    function addUser(){ 
      const username=prompt("Enter username:"); 
      const password=prompt("Enter password:"); 
      const role=prompt("Enter role (staff/admin):"); 
      const name=prompt("Enter full name:"); 
      
      if(username && password && role && name){ 
        const staffUsers = JSON.parse(localStorage.getItem('staffUsers') || '[]');
        const newUser = {
          id: Date.now(),
          username: username,
          password: password,
          role: role,
          name: name,
          createdAt: new Date().toISOString()
        };
        
        staffUsers.push(newUser);
        localStorage.setItem('staffUsers', JSON.stringify(staffUsers));
        displayUsers(); 
        alert(`User ${username} created successfully as ${role}`);
      } 
    }

    function editUser(userType, index){ 
      const users = JSON.parse(localStorage.getItem(userType) || '[]');
      const user = users[index];
      
      const username=prompt("Edit username:", user.username); 
      const password=prompt("Edit password:", user.password); 
      const role=prompt("Edit role:", user.role); 
      const name=prompt("Edit name:", user.name || user.username);
      
      if(username && password && role && name){ 
        users[index] = {
          ...user,
          username: username,
          password: password,
          role: role,
          name: name
        };
        localStorage.setItem(userType, JSON.stringify(users));
        displayUsers(); 
      } 
    }

    function deleteUser(userType, index){ 
      const users = JSON.parse(localStorage.getItem(userType) || '[]');
      const user = users[index];
      
      if(confirm(`Delete user "${user.name || user.username}"?`)){ 
        users.splice(index,1); 
        localStorage.setItem(userType, JSON.stringify(users));
        displayUsers(); 
      } 
    }

    // ===== Navigation Functions =====
    function showSection(sectionId){
      document.querySelectorAll('.section').forEach(s=>{
        s.classList.add('hidden');
        s.classList.remove('active');
      }); 
      const s=document.getElementById(sectionId); 
      s.classList.remove('hidden'); 
      setTimeout(() => s.classList.add('active'), 50);
    }

    // ===== Event Listeners =====
    document.addEventListener('DOMContentLoaded', function() {
      initApp();

      document.getElementById('homeBtn').onclick=()=>showSection('homepageSection');
      document.getElementById('browseBtn').onclick=()=>showSection('browseSection');
      document.getElementById('placeOrderBtn').onclick=()=>{
        if(cart.length===0){ alert("Your cart is empty!"); return; }
        showSection('placeOrderSection'); 
        displayCartInPlaceOrder();
      };
      document.getElementById('confirmCartBtn').onclick=()=>{
        if(cart.length===0){ alert("Your cart is empty!"); return; }
        let summary = "Please confirm your order:\n\n";
        let total=0;
        cart.forEach(item=>{ 
          const itemTotal=item.price*item.quantity; 
          total+=itemTotal; 
          summary+=`${item.name} x${item.quantity} - ‚Ç±${itemTotal}\n`; 
        });
        summary+=`\nTotal: ‚Ç±${total}`;
        if(confirm(summary)){ openPaymentModal(); }
      };
      document.getElementById('paymentBtn').onclick=openPaymentModal;
      document.getElementById('trackBtn').onclick=()=>{ showSection('trackOrderSection'); displayOrders(); };
      document.getElementById('updateBtn').onclick=()=>{ showSection('updateOrderSection'); displayUpdateOrders(); };
      document.getElementById('manageMenuBtn').onclick=()=>{ showSection('manageMenuSection'); displayMenuItems(); };
      document.getElementById('manageUsersBtn').onclick=()=>{ showSection('manageUsersSection'); displayUsers(); };
      document.getElementById('orderNowBtn').onclick=()=>showSection('browseSection');
      
      document.getElementById('logoutBtn').onclick=function() {
        localStorage.removeItem('currentUser');
        // Redirect to appropriate login page based on current user type
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (currentUser && (currentUser.role === 'staff' || currentUser.role === 'admin')) {
          window.location.href = 'staff-login.html';
        } else {
          window.location.href = 'customer-login.html';
        }
      };
    });

    // Close modal when clicking outside
    document.getElementById('paymentModal').onclick = function(e) {
      if (e.target === this) closePaymentModal();
    };
  </script>
</body>
</html>